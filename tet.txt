#!/bin/ksh

echo "{"
echo "  \"data\":["

YEAR_AGO=$(perl -e 'print time() - 365*24*3600, "\n"')
FIRST=1

lsuser -c ALL | grep -v '^#' | cut -d: -f1 | while read user
do
    ts=$(lsuser -a time_last_login "$user" 2>/dev/null | awk '{print $2}' | cut -d= -f2)
    [ -z "$ts" ] && continue
    [ "$ts" -eq 0 ] 2>/dev/null && continue
    [ "$ts" -lt "$YEAR_AGO" ] && continue
    if [ $FIRST -eq 0 ]; then
        printf ",\n"
    fi
    printf "    { \"{#USERNAME}\":\"%s\" }" "$user"
    FIRST=0
done

echo ""
echo "  ]"
echo "}"
